{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "ResourceGroupLocation": {
            "type": "string",
            "metadata": {
                "description": "Deployment region"
            }
        },
        "ResourceGroup_Name": {
            "type": "string",
            "metadata": {
                "description": "Deployment region"
            }
        },
        "vmName": {
            "type": "string",
            "metadata": {
                "description": "VM Name"
            }
        },
        "vmSize": {
            "type": "string",
            "metadata": {
                "description": "VM Size"
            },
            "defaultValue": "Standard_GS5",
            "allowedValues": [
                "Standard_GS5",
                "Standard_M64s",
                "Standard_M64ms",
                "Standard_M128s",
                "Standard_M128ms"
            ]
        },
        "networkName": {
            "type": "string",
            "metadata": {
                "description": "The Hana vNet"
            }
        },
        "addressPrefixes": {
            "type": "string",
            "metadata": {
                "description": "The Hana vNET prefix"
            }
        },
        "subnetName": {
            "type": "string",
            "metadata": {
                "description": "The Hana subnet name"
            }
        },
        "subnetPrefix": {
            "type": "string",
            "metadata": {
                "description": "The data subnet"
            }
        },
        "fileUri": {
            "type": "string",
            "metadata": {
                "decription": "Uri for MOF file"
            }
        },
        "customUri": {
            "type": "string",
            "metadata": {
                "description": "Uri for Custom Script Extension"
            }
        },
        "baseUri": {
            "type": "string",
            "metadata": {
                "description": "Base deployment uri"
            }
        },
        "AzureDscUri": {
            "type": "string",
            "metadata": {
                "description": "Uri for Azure Automation DSC"
            }
        },
        "AzureDscKey": {
            "type": "string",
            "metadata": {
                "description": "Key for Azure Automation DSC"
            }
        },
        "DscConfigName": {
            "type": "string",
            "metadata": {
                "description": "Name of AzureAutomation Config"
            }
        }
    },
    "variables": {
        "vmName": "[toLower(parameters('vmName'))]",
        "gs5Uri": "[concat(parameters('baseUri'), '\\Vms\\gs5.json')]",
        "m64sUri": "[concat(parameters('baseUri'), '\\Vms\\m64s.json')]",
        "m64msUri": "[concat(parameters('baseUri'), '\\Vms\\m64ms.json')]",
        "m128sUri": "[concat(parameters('baseUri'), '\\Vms\\m128s.json')]",
        "m128msUri": "[concat(parameters('baseUri'), '\\Vms\\m128ms.json')]"
    },
    "resources": [{
            "condition": "[equals(parameters('vmSize'), 'Standard_GS5')]",
            "apiVersion": "2016-09-01",
            "name": "Gs5LinkedTemplate",
            "type": "Microsoft.Resources/deployments",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[variables('gs5Uri')]"
                },
                "parameters": {
                    "vmName": {
                        "value": "[variables('vmName')]"
                    },
                    "fileUri": {
                        "value": "[parameters('fileUri')]"
                    },
                    "customUri": {
                        "value": "[parameters('customUri')]"
                    },
                    "networkName": {
                        "value": "[parameters('networkName')]"
                    },
                    "addressPrefixes": {
                        "value": "[parameters('addressPrefixes')]"
                    },
                    "subnetName": {
                        "value": "[parameters('subnetName')]"
                    },
                    "subnetPrefix": {
                        "value": "[parameters('subnetPrefix')]"
                    },
                    "AzureDscUri": {
                        "value": "[parameters('AzureDscUri')]"
                    },
                    "AzureDscKey": {
                        "value": "[parameters('AzureDscKey')]"
                    },
                    "DscConfigName": {
                        "value": "[parameters('DscConfigName')]"
                    }
                }
            }
        },
        {
            "condition": "[equals(parameters('vmSize'), 'Standard_M64s')]",
            "apiVersion": "2016-09-01",
            "name": "M64sLinkedTemplate",
            "type": "Microsoft.Resources/deployments",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[variables('m64sUri')]"
                },
                "parameters": {
                    "vmName": {
                        "value": "[variables('vmName')]"
                    },
                    "fileUri": {
                        "value": "[parameters('fileUri')]"
                    },
                    "customUri": {
                        "value": "[parameters('customUri')]"
                    },
                    "networkName": {
                        "value": "[parameters('networkName')]"
                    },
                    "addressPrefixes": {
                        "value": "[parameters('addressPrefixes')]"
                    },
                    "subnetName": {
                        "value": "[parameters('subnetName')]"
                    },
                    "subnetPrefix": {
                        "value": "[parameters('subnetPrefix')]"
                    },
                    "AzureDscUri": {
                        "value": "[parameters('AzureDscUri')]"
                    },
                    "AzureDscKey": {
                        "value": "[parameters('AzureDscKey')]"
                    },
                    "DscConfigName": {
                        "value": "[parameters('DscConfigName')]"
                    }
                }
            }
        },
        {
            "condition": "[equals(parameters('vmSize'), 'Standard_M64ms')]",
            "apiVersion": "2016-09-01",
            "name": "M64msLinkedTemplate",
            "type": "Microsoft.Resources/deployments",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[variables('m64msUri')]"
                },
                "parameters": {
                    "vmName": {
                        "value": "[variables('vmName')]"
                    },
                    "fileUri": {
                        "value": "[parameters('fileUri')]"
                    },
                    "customUri": {
                        "value": "[parameters('customUri')]"
                    },
                    "networkName": {
                        "value": "[parameters('networkName')]"
                    },
                    "addressPrefixes": {
                        "value": "[parameters('addressPrefixes')]"
                    },
                    "subnetName": {
                        "value": "[parameters('subnetName')]"
                    },
                    "subnetPrefix": {
                        "value": "[parameters('subnetPrefix')]"
                    },
                    "AzureDscUri": {
                        "value": "[parameters('AzureDscUri')]"
                    },
                    "AzureDscKey": {
                        "value": "[parameters('AzureDscKey')]"
                    },
                    "DscConfigName": {
                        "value": "[parameters('DscConfigName')]"
                    }
                }
            }
        },
        {
            "condition": "[equals(parameters('vmSize'), 'Standard_M128s')]",
            "apiVersion": "2016-09-01",
            "name": "M128sLinkedTemplate",
            "type": "Microsoft.Resources/deployments",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[variables('m128sUri')]"
                },
                "parameters": {
                    "vmName": {
                        "value": "[variables('vmName')]"
                    },
                    "fileUri": {
                        "value": "[parameters('fileUri')]"
                    },
                    "customUri": {
                        "value": "[parameters('customUri')]"
                    },
                    "networkName": {
                        "value": "[parameters('networkName')]"
                    },
                    "addressPrefixes": {
                        "value": "[parameters('addressPrefixes')]"
                    },
                    "subnetName": {
                        "value": "[parameters('subnetName')]"
                    },
                    "subnetPrefix": {
                        "value": "[parameters('subnetPrefix')]"
                    },
                    "AzureDscUri": {
                        "value": "[parameters('AzureDscUri')]"
                    },
                    "AzureDscKey": {
                        "value": "[parameters('AzureDscKey')]"
                    },
                    "DscConfigName": {
                        "value": "[parameters('DscConfigName')]"
                    }
                }
            }
        },
        {
            "condition": "[equals(parameters('vmSize'), 'Standard_M128ms')]",
            "apiVersion": "2016-09-01",
            "name": "M128msLinkedTemplate",
            "type": "Microsoft.Resources/deployments",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[variables('m128msUri')]"
                },
                "parameters": {
                    "vmName": {
                        "value": "[variables('vmName')]"
                    },
                    "fileUri": {
                        "value": "[parameters('fileUri')]"
                    },
                    "customUri": {
                        "value": "[parameters('customUri')]"
                    },
                    "networkName": {
                        "value": "[parameters('networkName')]"
                    },
                    "addressPrefixes": {
                        "value": "[parameters('addressPrefixes')]"
                    },
                    "subnetName": {
                        "value": "[parameters('subnetName')]"
                    },
                    "subnetPrefix": {
                        "value": "[parameters('subnetPrefix')]"
                    },
                    "AzureDscUri": {
                        "value": "[parameters('AzureDscUri')]"
                    },
                    "AzureDscKey": {
                        "value": "[parameters('AzureDscKey')]"
                    },
                    "DscConfigName": {
                        "value": "[parameters('DscConfigName')]"
                    }
                }
            }
        }
    ],
    "outputs": {}
}